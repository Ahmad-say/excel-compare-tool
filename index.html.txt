<!DOCTYPE html>
<html lang="en" dir="ltr">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Excel Comparison Tool — Dates Fixed</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css">

<style>
body {
  margin:0; padding:0;
  font-family: system-ui,Segoe UI,Roboto,Arial;
  background: linear-gradient(to bottom right, rgba(0,0,0,0.4), rgba(0,0,0,0.6)), url('OIP1.webp') no-repeat center center fixed;
  background-size: cover;
  color:#fff;
}
.container{ display:flex; justify-content:center; align-items:flex-start; padding:50px 20px; }
.main-card{
  background: rgba(255,255,255,0.95); border-radius:20px; padding:40px; max-width:1000px; width:100%; box-shadow:0 20px 40px rgba(0,0,0,0.3); color:#0f172a;
}
h1{ text-align:center; font-size:32px; background: linear-gradient(90deg,#2563eb,#3b82f6); -webkit-background-clip: text; -webkit-text-fill-color: transparent; margin-bottom:12px; }
p{ text-align:center; color:#334155; font-size:16px; }
.controls{ display:grid; grid-template-columns:1fr 1fr 1fr; gap:20px; margin-bottom:20px; }
label{ display:block; margin:6px 0 4px; font-weight:600; }
input[type=file], input[type=text], select{ width:100%; padding:8px 12px; border-radius:10px; border:1px solid #cbd5e1; box-sizing:border-box; }
button{ background:#2563eb; color:#fff; border:none; padding:12px 20px; border-radius:12px; cursor:pointer; font-size:16px; transition: all 0.3s ease; }
button:hover{ transform: translateY(-3px) scale(1.05); box-shadow:0 8px 20px rgba(0,0,0,0.3); }
.icon{ font-size:50px; display:inline-block; animation:bounce 1s infinite; }
.icon-green{ color:#22c55e; }
.icon-red{ color:#ef4444; }
@keyframes bounce{0%,100%{ transform: translateY(0); }50%{ transform: translateY(-10px); }}
#resultArea{ margin-top:20px; max-height:500px; overflow-y:auto; border-radius:12px; box-shadow:0 6px 18px rgba(0,0,0,0.2); background:#fff; padding:12px;}
#resultArea table{ border-collapse:collapse; width:100%; font-size:14px; }
#resultArea th,#resultArea td{ border:1px solid #94a3b8; padding:8px 10px; text-align:center; }
#resultArea td.diff{ background:#fee2e2; color:#b91c1c; font-weight:700; }
</style>

<script src="https://cdn.sheetjs.com/xlsx-latest/package/dist/xlsx.full.min.js"></script>
</head>
<body>
<div class="container">
  <div class="main-card">
    <h1>Excel Comparison Tool</h1>
    <div style="text-align:center; margin-bottom:20px;"><i class="fas fa-file-excel icon icon-green"></i></div>
    <p>Upload two Excel or CSV files. The tool compares the first sheet or the sheet you specify.</p>

    <div class="controls">
      <div>
        <label>File A</label>
        <input type="file" id="fileA" accept=".xlsx,.xls,.csv">
      </div>
      <div>
        <label>File B</label>
        <input type="file" id="fileB" accept=".xlsx,.xls,.csv">
      </div>
      <div>
        <label>Sheet Name (leave empty for first sheet)</label>
        <input id="sheetName" placeholder="Sheet1">
        <button id="compareBtn" style="margin-top:12px; width:100%;">Compare Now</button>
      </div>
    </div>

    <div id="resultArea"></div>
  </div>
</div>

<script>
// قراءة الملفات
function readFile(file){
  return new Promise(resolve=>{
    const reader=new FileReader();
    reader.onload=e=>resolve(e.target.result);
    reader.readAsBinaryString(file);
  });
}

// تحويل كل القيم للتنسيق الصحيح (تواريخ وأرقام ونصوص)
function sheetToMatrix(ws){
  // استخدم XLSX.utils.sheet_to_json مع raw:false ليحول التواريخ تلقائياً
  const data = XLSX.utils.sheet_to_json(ws, {header:1, raw:false});
  return data;
}

// المقارنة
function compareSheets(){
  const fileA=document.getElementById('fileA').files[0];
  const fileB=document.getElementById('fileB').files[0];
  const sheetName=document.getElementById('sheetName').value;
  if(!fileA||!fileB){ alert("Please select both files."); return; }

  Promise.all([readFile(fileA),readFile(fileB)]).then(data=>{
    const wbA=XLSX.read(data[0],{type:'binary'});
    const wbB=XLSX.read(data[1],{type:'binary'});
    const name=sheetName || wbA.SheetNames[0];
    const wsA=wbA.Sheets[name];
    const wsB=wbB.Sheets[name];
    if(!wsA||!wsB){ alert("Sheet not found."); return; }
    const rowsA=sheetToMatrix(wsA);
    const rowsB=sheetToMatrix(wsB);
    renderTable(rowsA,rowsB);
  });
}

// عرض النتائج
function renderTable(rowsA, rowsB){
  const resultDiv=document.getElementById('resultArea');
  resultDiv.innerHTML="";

  const maxRows = Math.max(rowsA.length, rowsB.length);
  const maxCols = Math.max(...rowsA.map(r=>r.length), ...rowsB.map(r=>r.length));
  const headerRow = rowsA[0] || [];

  let html="<table><thead><tr><th>Row</th><th>Column</th><th>File A</th><th>File B</th></tr></thead><tbody>";
  let differencesFound=false;

  for(let i=1;i<maxRows;i++){
    const rowA=rowsA[i]||[];
    const rowB=rowsB[i]||[];
    for(let j=0;j<maxCols;j++){
      const cellA=rowA[j]||"";
      const cellB=rowB[j]||"";
      if(cellA!==cellB){
        differencesFound=true;
        const colHeader = headerRow[j] || "Column "+(j+1);
        html+=`<tr>
          <td>${i+1}</td>
          <td>${colHeader}</td>
          <td class="diff"><i class="fas fa-exclamation-circle icon icon-red"></i> ${cellA}</td>
          <td class="diff"><i class="fas fa-exclamation-circle icon icon-red"></i> ${cellB}</td>
        </tr>`;
      }
    }
  }

  html+="</tbody></table>";

  if(!differencesFound){
    resultDiv.innerHTML = `
      <div style="text-align:center; margin-top:20px;">
        <i class="fas fa-check-circle icon icon-green"></i>
        <p style="font-size:18px; font-weight:bold; color:#065f46;">No differences found — all cells match.</p>
      </div>`;
  } else {
    resultDiv.innerHTML = html;
  }
}

document.getElementById('compareBtn').addEventListener('click',compareSheets);
</script>
</body>
</html>
